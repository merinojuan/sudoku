<main class="max-w-xl mx-auto px-4">
  <header #box class="py-4 flex items-center justify-between gap-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 25.399999 25.400001"
      class="w-8 text-primary"
    >
      <g>
        <g
          transform="matrix(0.38452172,0,0,0.38459484,-36.376081,-0.99753452)"
          style="fill:currentColor"
        >
          <path
            style="fill:currentColor;stroke:none;stroke-width:0.0450546;paint-order:stroke fill markers"
            d="m 98.887203,68.53877 c -0.629601,-0.120232 -1.706435,-0.639178 -2.251832,-1.085194 -0.950914,-0.777642 -1.550954,-1.723673 -1.860199,-2.932811 -0.170535,-0.666784 -0.174323,-1.294725 -0.174323,-28.902006 0,-27.8085291 0.0026,-28.230572 0.178006,-28.9164096 0.260338,-1.0179108 0.660409,-1.709167 1.440929,-2.489687 0.780519,-0.7805199 1.471776,-1.1805906 2.489687,-1.4409283 0.685837,-0.1754077 1.10788,-0.1780058 28.916409,-0.1780058 27.60728,0 28.23522,0.00379 28.90201,0.1743222 1.20913,0.3092456 2.15516,0.9092859 2.93281,1.8601996 0.4713,0.5763217 0.96184,1.6230215 1.09185,2.3297977 0.13918,0.7565715 0.13918,56.5648492 0,57.3214202 -0.20358,1.106672 -0.96617,2.377207 -1.89806,3.162289 -0.50995,0.429625 -1.6918,0.980813 -2.3679,1.104342 -0.6909,0.126232 -56.737473,0.119076 -57.399387,-0.0073 z m 10.423977,-8.335039 5.20381,-0.05973 V 50.021472 39.898947 h -3.9951 c -2.19731,0 -5.58317,-0.02686 -7.52413,-0.05969 l -3.529013,-0.0597 V 50.021593 60.26363 l 2.320313,-8.5e-5 c 1.27617,-4.7e-5 4.66203,-0.02696 7.52412,-0.05981 z m 13.56144,2.64e-4 1.82471,-0.05912 9e-5,-1.585137 c 7e-5,-0.871823 0.0269,-3.136141 0.0597,-5.031814 l 0.0596,-3.446677 h 2.50842 2.50843 l 5.3e-4,4.167553 c 2.6e-4,2.292151 0.0266,4.562903 0.0586,5.046115 l 0.0582,0.878564 h 2.46442 2.46441 v -5.046114 -5.046118 l -1.37417,-2.64e-4 c -0.75579,-1.8e-4 -1.89116,-0.02673 -2.52306,-0.05896 l -1.14889,-0.05859 V 47.51269 45.061948 l -0.7434,-0.05787 c -0.40887,-0.03183 -1.53944,-0.05811 -2.51238,-0.05841 l -1.76892,-5.29e-4 -0.0664,-2.523059 -0.0664,-2.523056 h -2.45277 -2.45277 l -0.0596,2.853134 c -0.0328,1.569226 -0.0596,6.15128 -0.0596,10.182342 v 7.329207 l 0.69835,-2.65e-4 c 0.38409,-9e-5 1.51947,-0.02684 2.52306,-0.05936 z m 28.69978,-0.0297 3.49174,-7.94e-4 V 50.036217 39.898931 h -2.37686 c -2.10067,0 -2.39124,0.0173 -2.50054,0.148961 -0.10208,0.122962 -0.12885,1.451864 -0.1534,7.614229 l -0.0297,7.465269 h -2.50277 -2.50276 l -0.0663,-7.591703 c -0.0365,-4.175437 -0.0728,-7.596372 -0.0807,-7.602079 -0.008,-0.0057 -1.09907,-0.0382 -2.4248,-0.0722 l -2.41042,-0.06183 v 7.663908 7.663907 h 2.43295 2.43295 l 0.0106,1.284055 c 0.006,0.706231 0.0363,1.831469 0.0676,2.500532 l 0.0569,1.216475 1.08131,0.05424 c 0.59472,0.02983 1.28406,0.04032 1.53186,0.02331 0.2478,-0.01701 2.02182,-0.03128 3.94228,-0.03171 z M 134.82685,44.847812 c 0.0719,-0.07206 0.0794,-4.507889 0.008,-4.692192 -0.0317,-0.08185 -0.14614,-0.172527 -0.25422,-0.201515 -0.10808,-0.02898 -1.19424,-0.05326 -2.41369,-0.05393 l -2.21716,-0.0013 -0.0575,0.608238 c -0.0316,0.334528 -0.0577,1.473292 -0.0581,2.530583 l -5.3e-4,1.922346 2.47061,-0.03005 c 1.35883,-0.01654 2.49404,-0.05354 2.52268,-0.08224 z m -28.66173,-13.478846 3.66419,-0.05971 6.3e-4,-1.900166 c 3.7e-4,-1.045091 0.0265,-2.173873 0.0581,-2.508403 l 0.0574,-0.608238 h 2.51003 2.51003 l -2.7e-4,-0.83351 c -1.9e-4,-0.458425 -0.0268,-1.593801 -0.0593,-2.523053 l -0.059,-1.689548 h -2.45016 -2.45017 l -0.0582,0.878565 c -0.032,0.483211 -0.0584,1.618587 -0.0586,2.523058 l -4.5e-4,1.644494 h -5.00105 -5.001066 v 2.568113 2.568113 h 1.336876 c 0.73527,0 2.98575,-0.02687 5.00106,-0.05971 z m 40.45904,0 3.66419,-0.05971 v -0.87199 c 0,-0.479597 0.0267,-1.608379 0.0593,-2.508405 l 0.0593,-1.636412 h 2.50884 2.50883 v -3.680146 c 0,-2.024083 -0.0266,-4.294835 -0.0591,-5.046116 l -0.0591,-1.365965 h -2.44938 -2.44938 l -0.0627,5.019155 c -0.0345,2.760536 -0.0741,5.030559 -0.088,5.044497 -0.0139,0.01394 -1.12766,-7.14e-4 -2.47493,-0.03255 l -2.44959,-0.05789 V 21.200952 16.22847 l 2.49709,-0.06324 c 1.3734,-0.03478 2.51165,-0.0778 2.52943,-0.09559 0.0178,-0.01779 0.003,-1.144886 -0.0322,-2.504662 l -0.0645,-2.472321 -3.02811,-0.05924 c -1.66546,-0.03258 -3.91006,-0.0593 -4.98799,-0.05938 l -1.95988,-1.45e-4 V 21.201283 31.42868 h 1.33688 c 0.73527,0 2.98575,-0.02687 5.00106,-0.05971 z M 135.22127,21.339631 c -0.0248,-9.458928 -0.0349,-10.007628 -0.18713,-10.159815 -0.14683,-0.146797 -0.35854,-0.159439 -2.41933,-0.144458 -1.24213,0.009 -2.28482,0.04281 -2.31709,0.07507 -0.0323,0.03226 -0.0695,3.461411 -0.0827,7.62034 l -0.024,7.561689 h -2.50693 -2.50694 l -0.0595,-3.311514 c -0.0328,-1.821333 -0.0596,-5.247736 -0.0597,-7.614229 l -1.3e-4,-4.302716 h -2.47629 -2.47628 l -0.048,0.202746 c -0.0264,0.11151 -0.0576,3.537919 -0.0693,7.614242 l -0.0213,7.411495 2.54558,-1.2e-5 2.54559,-1.2e-5 v 1.969184 c 0,1.083051 0.0261,2.218428 0.0579,2.523059 l 0.0579,0.553874 h 5.03696 5.03696 z m -25.35915,-0.511362 c 0.0315,-0.229938 0.0573,-1.35881 0.0573,-2.508605 v -2.090537 l 2.4941,-0.06059 c 1.37175,-0.03332 2.51098,-0.07746 2.5316,-0.09809 0.0206,-0.02062 0.008,-1.155515 -0.0285,-2.521978 l -0.066,-2.484479 -3.25403,-0.01815 c -3.66848,-0.02046 -6.23862,0.01054 -6.4806,0.07817 -0.0896,0.02504 -0.20106,0.146014 -0.24776,0.268845 -0.0467,0.12283 -0.11169,1.234462 -0.14443,2.470293 l -0.0595,2.246965 h -2.41853 -2.418526 v 2.568112 2.568113 h 4.988816 4.98881 z"
          />
          <path
            style="fill:currentColor;stroke:none;stroke-width:0.0450546;paint-order:stroke fill markers"
            d="m 105.00846,55.045666 -0.45054,-0.05342 -0.0531,-0.67582 c -0.0292,-0.3717 -0.0328,-2.612041 -0.008,-4.978535 l 0.045,-4.302715 1.85537,-5.29e-4 c 1.02045,-2.65e-4 2.12907,-0.02649 2.4636,-0.05808 l 0.60824,-0.05744 v 5.104202 5.104201 l -2.00493,-0.01415 c -1.10271,-0.0078 -2.20767,-0.0382 -2.45547,-0.06758 z"
          />
        </g>
      </g>
    </svg>
    <div title="Cambiar tema" class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-sm gap-2">
        <div class="bg-base-100 border-base-content/10 grid shrink-0 grid-cols-2 gap-0.5 rounded-md border p-1">
          <div class="bg-base-content size-1 rounded-full"></div>
          <div class="bg-primary size-1 rounded-full"></div>
          <div class="bg-secondary size-1 rounded-full"></div>
          <div class="bg-accent size-1 rounded-full"></div>
        </div>
        <span>{{ themeService.getCurrentTheme()() }}</span>
      </div>
      <div
        tabindex="0"
        class="dropdown-content bg-base-200 text-base-content rounded-box top-px h-[30.5rem] max-h-[calc(100vh-8.6rem)] overflow-y-auto border border-white/5 shadow-2xl outline-1 outline-black/5 mt-10"
      >
        <ul class="menu w-56">
          <li class="menu-title text-xs">Temas</li>
          @for (theme of themeService.themes; let i = $index; track i) {
            <li>
              <button class="gap-3" [attr.data-set-theme]="theme" (click)="setTheme(theme)">
                <div [attr.data-theme]="theme" class="bg-base-100 grid shrink-0 grid-cols-2 gap-0.5 rounded-md p-1 shadow-sm">
                  <div class="bg-base-content size-1 rounded-full"></div>
                  <div class="bg-primary size-1 rounded-full"></div>
                  <div class="bg-secondary size-1 rounded-full"></div>
                  <div class="bg-accent size-1 rounded-full"></div>
                </div>
                <div class="w-32 truncate">{{ theme }}</div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-3 w-3 shrink-0" [class.invisible]="theme !== themeService.getCurrentTheme()()">
                  <path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"></path>
                </svg>
              </button>
            </li>
          }
        </ul>
      </div>
    </div>
  </header>

  <section class="flex flex-wrap justify-center gap-2 py-3">
    <button class="btn" (click)="getSudoku('easy')">Fácil</button>
    <button class="btn" (click)="getSudoku('medium')">Moderado</button>
    <button class="btn" (click)="getSudoku('hard')">Difícil</button>
    <button class="btn btn-primary" (click)="getSudoku('expert')">Experto</button>
  </section>

  @if (history.length) {
    <section class="relative my-3">
      @if (history.at(-1)!.isCompleted) {
        <div class="absolute z-10 flex items-center justify-center w-full h-full">
          <div class="card bg-base-100 shadow-sm w-3/4">
            <div class="card-body">
              <h2 class="card-title justify-center text-center">
                @if (history.at(-1)!.isResolved) {
                  ¡Felicidades, Sudoku completado!
                } @else {
                  El Sudoku tiene errores, échale un vistazo
                }
              </h2>
            </div>
          </div>
        </div>
      }
      <div class="card relative grid grid-cols-9 bg-base-200 border-2 border-primary shadow-lg overflow-hidden" [class.blur-xs]="history.at(-1)!.isCompleted" [style.height]="height + 'px'">
        @for (cell of history.at(-1)!.cells.entries(); track cell[0]) {
        <div [class]="'relative ' + cell[1].cssClass">
          <div
            role="button"
            class="absolute select-none flex items-center justify-center w-full h-full"
            [ngClass]="{'bg-accent/30': (cell[1].isEditable && cell[1].setedValue && selectedInputValue() === cell[1].setedValue) || (!cell[1].isEditable && selectedInputValue() === cell[1].value)}"
            (click)="setValue(cell[0], cell[1])"
            (contextmenu)="setValue(cell[0], cell[1], $event)"
          >
            @if (cell[1].isEditable) {
              <span class="text-primary pointer-events-none" [style.fontSize]="height | fontSize:12">{{cell[1].setedValue || ''}}</span>
            } @else {
              <span class="pointer-events-none" [style.fontSize]="height | fontSize:12">{{cell[1].value}}</span>
            }
          </div>
          @if (cell[1].value && !cell[1].setedValue && cell[1].possibleValues.length) {
            <div class="absolute grid grid-cols-3 w-full h-full pointer-events-none">
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 1" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(1)">1</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 2" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(2)">2</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 3" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(3)">3</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 4" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(4)">4</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 5" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(5)">5</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 6" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(6)">6</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 7" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(7)">7</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 8" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(8)">8</span>
              </div>
              <div class="flex items-center justify-center" [class.text-primary]="selectedInputValue() === 9" [style.fontSize]="height | fontSize:42">
                <span [class.invisible]="!cell[1].possibleValues.includes(9)">9</span>
              </div>
            </div>
          }
        </div>
        }
      </div>
    </section>
  
    <section class="flex flex-wrap justify-center gap-2 pb-3">
      @for (value of history.at(-1)!.values.entries(); track value[0]) {
        <button class="relative btn btn-square text-xl mt-3" [class.btn-primary]="selectedInputValue() === value[0]" [disabled]="history.at(-1)!.isResolved" (click)="setSelectedInputValue(value[0])">
          <div class="absolute -bottom-3.5 mx-auto badge badge-sm badge-accent">{{ value[1] }}</div>
          {{ value[0] }}
        </button>
      }
    </section>
  
    <section class="flex flex-wrap items-center justify-center gap-2 py-4">
      <button class="relative btn btn-square" [disabled]="history.length < 2 || history.at(-1)!.isResolved" (click)="undoLastMovement()">
        @if (history.length > 1) {
          <div class="absolute -bottom-3.5 mx-auto badge badge-sm badge-accent">{{ history.length - 1 }}</div>
        }
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6">
          <path d="M15 6l-6 6l6 6" />
        </svg>
      </button>
      <button class="btn btn-square" (click)="resetSudoku()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6">
          <path d="M3.06 13a9 9 0 1 0 .49 -4.087" />
          <path d="M3 4.001v5h5" />
        </svg>
      </button>
    </section>
  } @else {
    <section class="py-4">
      <div role="alert" class="alert">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-primary h-6 w-6 shrink-0">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Selecciona una dificultad para iniciar un nuevo Sudoku.</span>
      </div>
    </section>
  }
</main>